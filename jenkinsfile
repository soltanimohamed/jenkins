pipeline{
    agent any
    stages{
        stage('Deploy petstore'){
            steps{
                sh "docker-compose -f petstore.yml up -d"

                timeout(1) {
                    waitUntil {
                        script {
                            try {
                                def response = httpRequest url: "http://host.docker.internal:8080", validResponseCodes: '200:404'
                                return (response.status == 200)
                            } catch (Exception e){
                                return false;
                            }

                        }
                    }
                }
            }
        }
    }
    post {
        always {
            sh "docker-compose -f petstore.yml stop"
        }
    }
        
    
}
